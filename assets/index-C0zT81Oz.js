var be=Object.defineProperty;var ve=(e,t,s)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var I=(e,t,s)=>ve(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const Ge="https://fun-chat-app-cj829.ondigitalocean.app:80",ke="Fun Chat",Pe="2025",oe="--after-content",Z={BUTTON:"button",SUBMIT:"submit"},k={ABOUT:"About App",LOGOUT:"Logout",RETURN:"Return",SEND:"Send"},$={MIN:4,MAX:12},ge={MIN:6},G={MIN_LOGIN:`Must be at least ${$.MIN.toString()} characters long.`,MAX_LOGIN:`Must be no more than ${$.MAX.toString()} characters long.`,NO_SPECIAL_CHARACTERS:"Must contain only Latin letters and digits.",MIN_PASSWORD:`Must be at least ${ge.MIN.toString()} characters long. `,USE_CAPITAL_LETTER:"Password should contain at least one capital letter."},j={TEXT:"text",PASSWORD:"password"},me={LOGIN:"login",PASSWORD:"password"},v={LOGIN:"Enter name",NO_MESSAGES:"No messages",PASSWORD:"Enter password",SELECT_CHAT:"Select chat",SEARCH:"Find user..."},we="Login to start chatting",A={SCHOOL:{HREF:"https://rs.school",TEXT:"RS School"},GITHUB:{HREF:"https://github.com/asfound",TEXT:"asfound"},TARGET:"_blank"},h={USER_LOGIN:"USER_LOGIN",USER_LOGOUT:"USER_LOGOUT",USER_ACTIVE:"USER_ACTIVE",USER_INACTIVE:"USER_INACTIVE",MSG_SEND:"MSG_SEND",MSG_FROM_USER:"MSG_FROM_USER",MSG_READ:"MSG_READ",MSG_DELETE:"MSG_DELETE",MSG_EDIT:"MSG_EDIT"},xe={ERROR:"ERROR"},y={USER_EXTERNAL_LOGIN:"USER_EXTERNAL_LOGIN",USER_EXTERNAL_LOGOUT:"USER_EXTERNAL_LOGOUT",MSG_SEND:"MSG_SEND",MSG_DELIVER:"MSG_DELIVER",MSG_READ:"MSG_READ",MSG_DELETE:"MSG_DELETE",MSG_EDIT:"MSG_EDIT"},S="",ee=0,He=`App development is part of the JavaScript/Front-end 2024Q4 course at Rolling Scopes School. 
Author:`,B={UNKNOWN_PAYLOAD:"Unknown payload",INVALID_STATE:"Not a valid state",SOCKET_CLOSED:"Socket is closed",REQUEST_UNKNOWN:"Received response for unknown request"},ae={ONLINE:"online",OFFLINE:"offline"},Ve="Unread messages",x={EDITED:"Edited",DELIVERED:"Delivered",READ:"Read",SENT:"Sent"},D={LIB:"fas",DELETE:"fa-trash",DISCARD:"fa-xmark",CONFIRM:"fa-check",EDIT:"fa-pen-to-square"},$e="true",Be="User: ",Fe="Connecting...",l={SET_SOCKET_STATE:"socketStateChange",SET_CURRENT_USER:"setCurrentUser",SET_USERS:"setUsers",SET_SEARCH_VALUE:"setSearchValue",UPDATE_USER_STATUS:"updateUserStatus",SET_CURRENT_CHAT:"setCurrentChat",EMIT_CHAT_MESSAGE_EVENT:"emitChatMessageEvent",UPDATE_NOTIFICATION_COUNT:"updateNotificationCount"},ce=e=>({type:l.SET_SOCKET_STATE,payload:e}),he=e=>({type:l.SET_CURRENT_USER,payload:e}),qe=e=>({type:l.SET_USERS,payload:e}),Xe=e=>({type:l.SET_SEARCH_VALUE,payload:e}),We=e=>({type:l.UPDATE_USER_STATUS,payload:e}),Ce=e=>({type:l.SET_CURRENT_CHAT,payload:e}),U=e=>({type:l.EMIT_CHAT_MESSAGE_EVENT,payload:e}),F=e=>({type:l.UPDATE_NOTIFICATION_COUNT,payload:e});function E(e){return function(s,n,o){const a=document.createElement(e);if(s&&Object.assign(a,s),o)for(const[c,i]of Object.entries(o))a.setAttribute(c,i);return n&&a.append(...n.filter(c=>c!=null)),a}}const z=E("a"),Ye=E("article"),Ke=E("aside"),ze=E("button"),Qe=E("dialog"),d=E("div"),Je=E("fieldset"),Ze=E("footer"),Ae=E("form"),je=E("h1"),et=E("h2"),tt=E("header"),q=E("i"),st=E("img"),Ne=E("input"),nt=E("label"),ot=E("legend"),at=E("li"),te=E("p"),ct=E("section"),X=E("span"),Re=E("textarea"),rt=E("ul"),it="_loader_f4hsp_1",lt="_spinner_f4hsp_22",re={loader:it,spinner:lt};function dt(e){const t=d({className:re.loader}),s=d({className:re.spinner}),n=te({textContent:Fe});t.append(s,n);const o=()=>{document.body.append(t)},a=()=>{t.remove()};e.subscribe(l.SET_SOCKET_STATE,({isWebsocketOpen:c})=>{c?a():o()}),o()}const p={ADD_MESSAGE:"addMessage",DELETE_MESSAGE:"deleteMessage",EDIT_MESSAGE:"editMessage",DELIVERY_UPDATE:"deliveryUpdate",READ_UPDATE:"readUpdate"},Ie=1;function ut(e){switch(e.type){case y.USER_EXTERNAL_LOGIN:case y.USER_EXTERNAL_LOGOUT:{const t=e.payload;r.dispatch(We(t.user));break}case y.MSG_DELIVER:{const t=e.payload.message,s={kind:p.DELIVERY_UPDATE,id:t.id,status:t.status};r.dispatch(U(s));break}case y.MSG_SEND:{const t=e.payload.message,{currentChat:s}=r.getState();if(t.from===(s==null?void 0:s.userLogin)){const n={kind:p.ADD_MESSAGE,message:t};r.dispatch(U(n))}else{const n={userID:t.from,messageId:t.id};r.dispatch(F(n))}break}case y.MSG_READ:{const t=e.payload.message,s={kind:p.READ_UPDATE,id:t.id,status:t.status};r.dispatch(U(s));break}case y.MSG_DELETE:{const t=e.payload.message,s={kind:p.DELETE_MESSAGE,id:t.id,status:t.status};r.dispatch(U(s));const n={messageId:t.id};r.dispatch(F(n));break}case y.MSG_EDIT:{const t=e.payload.message,s={kind:p.EDIT_MESSAGE,id:t.id,text:t.text,status:t.status};r.dispatch(U(s));break}}}function Et(e){return typeof e!="object"||e===null||!("currentUser"in e)||!("searchValue"in e)?!1:e.currentUser===null||pt(e.currentUser)||typeof e.searchValue=="string"}function pt(e){return typeof e!="object"||e===null||!("login"in e)||!("password"in e)?!1:typeof e.login=="string"||typeof e.password=="string"}function _t(e){if(!Et(e))throw new TypeError(B.INVALID_STATE)}function St(e){return typeof e!="object"||e===null||!("error"in e)?!1:typeof e.error=="string"}function N(e){if(!St(e))throw new TypeError(B.UNKNOWN_PAYLOAD)}const Le="as_found-fun_chat";function ft(e){const t=gt(e);sessionStorage.setItem(Le,JSON.stringify(t))}function Tt(){const e=sessionStorage.getItem(Le);if(e){const t=JSON.parse(e);return _t(t),mt(t)}else return null}function gt(e){return{currentUser:e.currentUser,searchValue:e.searchValue}}function mt(e){return{...e,isWebsocketOpen:!1,users:new Map,unreadMessagesCounters:new Map,currentChat:null}}const ht={isWebsocketOpen:!1,currentUser:null,currentChat:null,users:new Map,unreadMessagesCounters:new Map,searchValue:S},Ct=Tt()??ht,At=(e,t)=>{switch(t.type){case l.SET_SOCKET_STATE:return{...e,isWebsocketOpen:t.payload};case l.SET_CURRENT_USER:return{...e,currentUser:t.payload};case l.SET_USERS:{const{users:s,unreadMessagesCounters:n}=t.payload,o=new Map(s.map(a=>[a.login,a]));return{...e,users:o,unreadMessagesCounters:n}}case l.SET_SEARCH_VALUE:return{...e,searchValue:t.payload};case l.UPDATE_USER_STATUS:{const s=structuredClone(e.users),n=t.payload;return s.set(n.login,n),{...e,users:s}}case l.SET_CURRENT_CHAT:return{...e,currentChat:t.payload};case l.EMIT_CHAT_MESSAGE_EVENT:{if(e.currentChat){const s=Rt(t,e.currentChat);return{...e,currentChat:s}}return e}case l.UPDATE_NOTIFICATION_COUNT:{const s=Nt(structuredClone(e.unreadMessagesCounters),t.payload);return{...e,unreadMessagesCounters:s}}default:return e}};function Nt(e,t){if(t.userID!==void 0&&t.messageId!==void 0){const s=e.get(t.userID)??[];s.push(t.messageId),e.set(t.userID,s)}else if(t.userID===void 0&&t.messageId!==void 0){for(const s of e.values())if(s.includes(t.messageId)){const n=s.indexOf(t.messageId);s.splice(n,Ie)}}else t.userID!==void 0&&e.set(t.userID,[]);return e}function Rt(e,t){const s=[...t.updatesQueue];s.push(e.payload);const n=t.messages;switch(e.payload.kind){case p.ADD_MESSAGE:{n.set(e.payload.message.id,e.payload.message);break}case p.DELETE_MESSAGE:{n.delete(e.payload.id);break}case p.EDIT_MESSAGE:{const o=n.get(e.payload.id);o&&(o.text=e.payload.text,o.status.isEdited=e.payload.status.isEdited,n.set(e.payload.id,o));break}case p.DELIVERY_UPDATE:{const o=n.get(e.payload.id);o&&(o.status.isDelivered=e.payload.status.isDelivered,n.set(e.payload.id,o));break}case p.READ_UPDATE:{const o=n.get(e.payload.id);o&&(o.status.isReaded=e.payload.status.isReaded,n.set(e.payload.id,o));break}}return{...t,updatesQueue:s,messages:n}}class It{constructor(){I(this,"events",new Map)}subscribe(t,s){var n;this.events.has(t)||this.events.set(t,[]),(n=this.events.get(t))==null||n.push(s)}unsubscribe(t,s){const n=this.events.get(t);n&&this.events.set(t,n.filter(o=>o!==s))}unsubscribeAll(t){this.events.delete(t)}emit(t,s){const n=this.events.get(t);if(n)for(const o of n)o(s)}}const Lt=(e,t)=>{let s=structuredClone(t);const n=new It;return{getState:()=>structuredClone(s),dispatch:o=>{s=e(s,o),n.emit(o.type,s)},subscribe:(o,a)=>(n.subscribe(o,a),()=>{n.unsubscribe(o,a)}),unsubscribeAll:o=>{n.unsubscribeAll(o)}}},r=Lt(At,Ct),Ut="_button_1vbc8_1",Dt={button:Ut},g=e=>{const{textContent:t,type:s=Z.BUTTON,className:n,onClick:o,disabled:a=!1}=e,c=ze({className:Dt.button,textContent:t,type:s});return n&&c.classList.add(n),o&&c.addEventListener("click",o),a&&(c.disabled=!0),c},yt="_container_opmrq_1",Ot="_link_opmrq_17",ie={container:yt,link:Ot};function Mt(){const e=d({className:ie.container}),t=te({textContent:He}),s=z({textContent:A.GITHUB.TEXT,href:A.GITHUB.HREF,target:A.TARGET,className:ie.link}),n=g({textContent:k.RETURN,onClick:()=>{history.back()}});return e.append(t,s,n),e}const bt="_container_1740c_1",vt="_login_1740c_8",Gt="_status_1740c_14",kt="_online_1740c_18",H={container:bt,login:vt,status:Gt,online:kt};function Pt(){const e=d({className:H.container});let t=!1;const s=({currentChat:n,users:o})=>{if(e.replaceChildren(),n){const a=o.get(n.userLogin);t=(a==null?void 0:a.isLogined)??!1;const c=et({textContent:n.userLogin,className:H.login}),i=d({textContent:t?ae.ONLINE:ae.OFFLINE,className:H.status});t&&i.classList.add(H.online),e.append(c,i)}};return s(r.getState()),r.subscribe(l.SET_CURRENT_CHAT,s),r.subscribe(l.UPDATE_USER_STATUS,n=>{const{currentChat:o,users:a}=n;if(o){const c=a.get(o.userLogin);(c==null?void 0:c.isLogined)!==t&&s(n)}}),e}const wt="_chat_1qb2j_1",xt={chat:wt},Ht="_modal_42yy5_1",Vt="_button_42yy5_11",le={modal:Ht,button:Vt},$t=3e3;function Bt(e){const t=Qe({className:le.modal}),s=()=>{t.close(),t.remove()};setTimeout(()=>{s()},$t),t.addEventListener("click",o=>{o.target===t&&s()});const n=g({textContent:S,className:le.button});return n.addEventListener("click",s),t.append(n,e),t}function C(e){const t=Bt(e);document.body.prepend(t),t.showModal()}function Ue(e,t){const s=R(),a={id:crypto.randomUUID(),payload:{user:{login:e,password:t}},type:h.USER_LOGIN};return s.sendRequest(a).then(c=>{const i={login:c.user.login,password:t};r.dispatch(he(i))})}function de(e){const t=R(),n={id:crypto.randomUUID(),payload:null,type:h[e]};return t.sendRequest(n)}function ue(e){Promise.all([de(h.USER_ACTIVE),de(h.USER_INACTIVE)]).then(t=>{const s=t.flatMap(n=>n.users);return Promise.all(s.filter(n=>n.login!==e).map(n=>ye(n.login).then(o=>[n.login,Ft(e,o)]))).then(n=>{const o=new Map(n),a={users:s,unreadMessagesCounters:o};r.dispatch(qe(a))})}).catch(t=>{N(t),C(t.error)})}function Ft(e,t){return t.filter(s=>!s.status.isReaded&&s.from!==e).map(s=>s.id)}const qt=3e3,L=class L{constructor(t,s){I(this,"webSocket",null);I(this,"store");I(this,"retryTimeoutId",null);I(this,"url");I(this,"requests",new Map);this.url=t,this.store=s}static getInstance(t,s){return L.instance??(L.instance=new L(t,s)),L.instance}open(){this.store.getState().isWebsocketOpen||(this.webSocket=new WebSocket(this.url),this.webSocket.addEventListener("open",()=>{this.retryTimeoutId!==null&&clearTimeout(this.retryTimeoutId),this.store.dispatch(ce(!0));const{currentUser:t}=r.getState();t&&Ue(t.login,t.password).catch(s=>{N(s),C(s.error)})},{once:!0}),this.webSocket.addEventListener("message",t=>{typeof t.data=="string"&&this.handleMessage(t.data)}),this.webSocket.addEventListener("close",()=>{this.handleDisconnect()}))}sendRequest(t){return this.store.getState().isWebsocketOpen&&this.webSocket?new Promise((s,n)=>{var o;this.requests.set(t.id,{resolve:s,reject:n}),(o=this.webSocket)==null||o.send(JSON.stringify(t))}):Promise.reject(new Error(B.SOCKET_CLOSED))}reopen(){this.retryTimeoutId=setTimeout(()=>{this.open()},qt)}handleDisconnect(){this.store.getState().isWebsocketOpen&&this.store.dispatch(ce(!1)),this.reopen()}handleMessage(t){const s=JSON.parse(t);if("id"in s&&s.id){const n=this.requests.get(s.id);n?(s.type===xe.ERROR&&"error"in s.payload?n.reject(s.payload):n.resolve(s.payload),this.requests.delete(s.id)):C(B.REQUEST_UNKNOWN)}else ut(s)}};I(L,"instance",null);let Q=L;function R(){return Q.getInstance(Ge,r)}function Xt(e,t){const s=R(),a={id:crypto.randomUUID(),payload:{message:{to:e,text:t}},type:h.MSG_SEND};return s.sendRequest(a).then(c=>{const i={kind:p.ADD_MESSAGE,message:c.message};r.dispatch(U(i))})}function Wt(e){const t=R(),o={id:crypto.randomUUID(),payload:{message:{id:e}},type:h.MSG_DELETE};t.sendRequest(o).then(a=>{const c={kind:p.DELETE_MESSAGE,id:a.message.id,status:a.message.status};r.dispatch(U(c))}).catch(a=>{N(a),C(a.error)})}function Yt(e,t){const s=R(),a={id:crypto.randomUUID(),payload:{message:{id:e,text:t}},type:h.MSG_EDIT};s.sendRequest(a).then(c=>{const i={kind:p.EDIT_MESSAGE,id:c.message.id,text:c.message.text,status:c.message.status};r.dispatch(U(i))}).catch(c=>{N(c),C(c.error)})}function De(e){const t=R(),o={id:crypto.randomUUID(),payload:{message:{id:e}},type:h.MSG_READ};t.sendRequest(o).catch(a=>{N(a),C(a.error)})}function Kt(e){ye(e).then(t=>{const s=zt(e,t);r.dispatch(Ce(s))}).catch(t=>{N(t),C(t.error)})}function ye(e){const t=R(),o={id:crypto.randomUUID(),payload:{user:{login:e}},type:h.MSG_FROM_USER};return t.sendRequest(o).then(a=>a.messages)}function zt(e,t){const s=new Map(t.map(n=>[n.id,n]));return{userLogin:e,messageHistory:t,messages:s,updatesQueue:[]}}const Qt="_dialog_6m4zz_1",Jt="_expander_6m4zz_17",se={dialog:Qt,expander:Jt},Zt="_divider_usjcv_1",jt="_text_usjcv_24",Ee={divider:Zt,text:jt};function es(){const e=d({className:Ee.divider}),t=X({textContent:Ve,className:Ee.text});return e.append(t),e}function ts(e){return new Date(e).toLocaleString("en-GB",{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!1})}const ss="_container_qokt8_1",ns="_message_qokt8_14",os="_text_qokt8_25",as="_header_qokt8_39",cs="_footer_qokt8_40",rs="_author_qokt8_51",is="_partner_qokt8_61",ls="_edited_qokt8_65",ds="_status_qokt8_69",m={container:ss,message:ns,text:os,header:as,footer:cs,author:rs,partner:is,edited:ls,status:ds};function ne(e,t){const s=d({className:m.container}),n=d({className:m.message}),o=Es(t),a=te({textContent:t.text,className:m.text}),c=d({textContent:t.status.isEdited?x.EDITED:S,className:m.edited}),i=d({className:m.footer},[c]);if(t.from===e){const u=t.status.isReaded?x.READ:t.status.isDelivered?x.DELIVERED:x.SENT,_=d({textContent:u,className:m.status}),b=_s(t),W=ps(t,a,n);i.append(_,W,b)}else s.classList.add(m.partner);return n.append(o,a,i),s.append(n),s}function us(e,t,s,n,o){const a=d({}),c=g({textContent:S,onClick:()=>{a.replaceWith(e),t.replaceWith(s),o.scrollIntoView()}}),i=q({});i.classList.add(D.LIB,D.DISCARD),c.append(i);const u=g({textContent:S,onClick:()=>{Yt(n,t.value)}}),_=q({});return _.classList.add(D.LIB,D.CONFIRM),u.append(_),a.append(u,c),a}function Es(e){const t=d({textContent:e.from,className:m.author}),s=d({textContent:ts(e.datetime)});return d({className:m.header},[t,s])}function ps(e,t,s){const n=g({textContent:S,onClick:()=>{const a=Re({value:e.text,className:m.text});t.replaceWith(a),a.style.height=`${a.scrollHeight.toString()}px`,a.scrollIntoView(),n.replaceWith(us(n,a,t,e.id,s))}}),o=q({});return o.classList.add(D.LIB,D.EDIT),n.append(o),n}function _s(e){const t=g({textContent:S,onClick:()=>{Wt(e.id)}}),s=q({});return s.classList.add(D.LIB,D.DELETE),t.append(s),t}function Ss(e,t,s){const{currentUser:n,currentChat:o}=t;if(!n||!o)return;const a=o.updatesQueue.shift();if(a)switch(a.kind){case p.ADD_MESSAGE:{gs({currentUser:n,currentChat:o,event:a,dialogContainer:e,messageElements:s});break}case p.DELIVERY_UPDATE:case p.READ_UPDATE:case p.EDIT_MESSAGE:{const c=s.get(a.id),i=o.messages.get(a.id);if(c&&i){const u=ne(n.login,i);c.replaceWith(u),s.set(i.id,u)}break}case p.DELETE_MESSAGE:{fs({currentChat:o,event:a,dialogContainer:e,messageElements:s});break}}}function fs(e){const{currentChat:t,event:s,dialogContainer:n,messageElements:o}=e,a=o.get(s.id);if(a&&(a.remove(),o.delete(s.id)),t.messages.size===ee){n.replaceChildren();const c=d({textContent:v.NO_MESSAGES});n.append(c)}}function Ts(e,t){const s={userID:e,messageId:t};r.dispatch(F(s))}function gs(e){const{currentUser:t,currentChat:s,event:n,dialogContainer:o,messageElements:a}=e,c=s.messages.get(n.message.id);if(!c)return;const i=ne(t.login,n.message);if(s.messages.size===Ie){o.replaceChildren();const _=d({className:se.expander});o.append(_)}o.append(i),a.set(c.id,i),t.login===c.from?J():Cs()?De(c.id):(As(c),Ts(c.from,c.id));const u=Ns();u?u.scrollIntoView():requestAnimationFrame(()=>{o.scrollTop=o.scrollHeight})}let P=!0,T,w=[];function ms(){const e=d({className:se.dialog}),t=new Map;let s;e.addEventListener("click",J),e.addEventListener("wheel",J);const n=({currentUser:o,currentChat:a})=>{e.replaceChildren(),t.clear(),T=null,w=[],P=!0,o&&a?(a.messageHistory.length>ee?hs({dialogContainer:e,currentChat:a,currentUser:o,messagesMap:t}):e.append(d({textContent:v.NO_MESSAGES})),s=r.subscribe(l.EMIT_CHAT_MESSAGE_EVENT,c=>{Ss(e,c,t)})):e.append(d({textContent:v.SELECT_CHAT}))};return n(r.getState()),r.subscribe(l.SET_CURRENT_CHAT,o=>{s!==void 0&&s(),n(o)}),e}function hs(e){const{dialogContainer:t,currentChat:s,currentUser:n,messagesMap:o}=e,a=d({className:se.expander});t.append(a);for(const c of s.messageHistory){c.from!==n.login&&!c.status.isReaded&&(w.push(c),T||(P=!1,T=es(),t.append(T)));const i=ne(n.login,c);t.append(i),o.set(c.id,i)}T?T.scrollIntoView():requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight})}function J(){if(!P){P=!0,T==null||T.remove(),T=null;for(const t of w)De(t.id);const{currentChat:e}=r.getState();if(e){const t={userID:e.userLogin};r.dispatch(F(t))}w=[]}}function Cs(){return P}function As(e){w.push(e)}function Ns(){return T}const Rs="_form_1tz01_1",Is="_textInput_1tz01_7",pe={form:Rs,textInput:Is};function Ls(){const e=Ae({className:pe.form}),t=({currentChat:s})=>{e.replaceChildren();const n=s==null?void 0:s.userLogin,o=n===void 0,a=Re({className:pe.textInput,disabled:o}),c=g({textContent:k.SEND,type:Z.SUBMIT,disabled:o||a.value===S});n&&Us(c,a,n),e.append(a,c)};return t(r.getState()),r.subscribe(l.SET_CURRENT_CHAT,t),e}function Us(e,t,s){const n=()=>{e.disabled=t.value===S};e.addEventListener("click",o=>{o.preventDefault(),Xt(s,t.value).then(()=>{t.value=S,e.disabled=!0}).catch(a=>{N(a),C(a.error)})}),t.addEventListener("input",n),t.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),e.click())})}function Ds(){const e=Ye({className:xt.chat});return(()=>{e.replaceChildren();const s=Pt(),n=ms(),o=Ls();e.append(s,n,o)})(r.getState()),e}const ys="_aside_1n0c5_1",Os="_input_1n0c5_10",_e={aside:ys,input:Os},Ms="_list_1lmgn_1",bs="_user_1lmgn_11",vs="_online_1lmgn_40",Y={list:Ms,user:bs,online:vs};function Gs(){const e=rt({className:Y.list}),t=({users:s,currentUser:n,searchValue:o,unreadMessagesCounters:a})=>{e.replaceChildren();const c=[...s.values()].filter(i=>i.login!==(n==null?void 0:n.login)).filter(i=>i.login.includes(o)).sort((i,u)=>i.isLogined!==u.isLogined?Number(u.isLogined)-Number(i.isLogined):i.login.localeCompare(u.login));for(const i of c){const u=at({textContent:i.login,className:Y.user}),_=a.get(i.login)??[];ks(u,_.length),i.isLogined&&u.classList.add(Y.online),u.addEventListener("click",()=>{Kt(i.login)}),e.append(u)}};return t(r.getState()),r.subscribe(l.SET_USERS,t),r.subscribe(l.SET_SEARCH_VALUE,t),r.subscribe(l.UPDATE_USER_STATUS,t),r.subscribe(l.UPDATE_NOTIFICATION_COUNT,t),e}function ks(e,t){t===ee?(e.style.setProperty(oe,S),delete e.dataset.hasNotifications):(e.style.setProperty(oe,`"${t.toString()}"`),e.dataset.hasNotifications=$e)}function Ps(){const e=Ke({className:_e.aside}),t=Ne({type:j.TEXT,placeholder:v.SEARCH,value:r.getState().searchValue,className:_e.input});t.addEventListener("input",()=>{r.dispatch(Xe(t.value))});const s=Gs();return e.append(t,s),e}const ws="data:image/svg+xml,%3csvg%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_5701_38384)'%3e%3ccircle%20cx='32'%20cy='32'%20r='32'%20fill='black'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13%2021.5095V42.5L19.3067%2042.4621V33.9474C20.0567%2033.9474%2020.7616%2033.9775%2021.4049%2034.4267C21.8946%2034.8785%2022.2838%2035.4335%2022.546%2036.054L25.9202%2042.4621H33C31.5957%2039.6675%2030.4706%2036.1327%2028.0552%2034.0104C27.5455%2033.6749%2026.9919%2033.4158%2026.411%2033.241C27.1873%2033.0779%2027.9357%2032.7973%2028.6319%2032.4084C30.3855%2031.3375%2031.3915%2029.3808%2031.3436%2027.3374C31.3798%2026.1328%2031.0495%2024.9466%2030.3988%2023.9441C28.9256%2021.6883%2025.9337%2021.4213%2023.4663%2021.5095H13ZM21.9939%2030.0116H19.3313V25.6975H22.1043C23.4807%2025.5594%2025.1814%2026.1754%2025.0859%2027.8041C25.1499%2029.5621%2023.3647%2029.9127%2021.9939%2030.0116Z'%20fill='%23FFB749'/%3e%3cpath%20d='M39.4768%2035.089L33%2035.4666C33.1262%2037.3671%2034.0021%2039.16%2035.4636%2040.5088C36.9117%2041.8323%2039.5076%2042.4941%2043.2515%2042.4941C46.3564%2042.5823%2049.9058%2041.8146%2051.821%2039.1569C52.5929%2038.0934%2053.0033%2036.8427%2052.9998%2035.564C53.0217%2033.1848%2051.4339%2031.2297%2049.3044%2030.3147C47.2632%2029.4766%2045.1198%2028.8674%2042.9204%2028.5C42.1107%2028.41%2041.3327%2028.1563%2040.6423%2027.757C39.9039%2027.2597%2040.078%2026.2272%2040.735%2025.7596C42.6084%2024.5207%2045.6299%2025.5545%2045.8608%2027.9032L52.2845%2027.5621C52.1703%2025.768%2051.1844%2024.0545%2049.6356%2022.9583C47.6987%2021.8887%2045.4532%2021.3874%2043.1986%2021.5212C41.3493%2021.4527%2039.5037%2021.7218%2037.7682%2022.3128C35.6082%2023.1125%2033.829%2025.064%2033.8344%2027.4525C33.7931%2028.9377%2034.5158%2030.4088%2035.755%2031.3621C37.6454%2032.6238%2039.8325%2033.4582%2042.139%2033.798C43.3833%2033.9637%2044.5727%2034.3795%2045.6224%2035.0159C46.5878%2035.7309%2046.5807%2037.167%2045.5959%2037.8903C44.5078%2038.6532%2042.9034%2038.7416%2041.6818%2038.2468C40.3717%2037.716%2039.6048%2036.4784%2039.4768%2035.089Z'%20fill='%23FFB749'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_5701_38384'%3e%3crect%20width='64'%20height='64'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",xs="_footer_1semp_1",Hs="_link_1semp_11",Vs="_logo_1semp_25",V={footer:xs,link:Hs,logo:Vs};function $s(){const e=Ze({className:V.footer}),t=z({textContent:A.SCHOOL.TEXT,href:A.SCHOOL.HREF,target:A.TARGET,className:V.link}),s=z({textContent:A.GITHUB.TEXT,href:A.GITHUB.HREF,target:A.TARGET,className:V.link}),n=st({src:ws,className:V.logo});t.prepend(n);const o=X({textContent:Pe});return e.append(t,s,o),e}const f={ABOUT:"about",LOGIN:"login",CHAT:"chat"};function Bs({root:e,routes:t}){function s(){const n=globalThis.location.hash.replace(/#/,S);if(!r.getState().currentUser&&n===f.CHAT)M(f.LOGIN);else if(r.getState().currentUser&&n===f.LOGIN)M(f.CHAT);else{const o=t.get(n);o?Fs(e,o):M(f.LOGIN)}}globalThis.addEventListener("hashchange",s),s()}function M(e){globalThis.location.hash=e}function Fs(e,t){e.replaceChildren(t())}const qs="_header_tqvfe_1",Xs="_title_tqvfe_13",Ws="_titleContainer_tqvfe_18",K={header:qs,title:Xs,titleContainer:Ws};function Ys(){var o;const e=d({}),t=X({textContent:Be}),s=(o=r.getState().currentUser)==null?void 0:o.login,n=X({textContent:s});return e.append(t,n),e}function Ks(){const e=tt({className:K.header}),t=Ys(),s=je({textContent:ke,className:K.title}),n=g({textContent:k.ABOUT,onClick:()=>{M(f.ABOUT)}}),o=g({textContent:k.LOGOUT,onClick:zs}),a=d({className:K.titleContainer},[s,t]);return e.append(n,a,o),e}function zs(){const e=R(),t=crypto.randomUUID(),{currentUser:s}=r.getState();if(s){const n={user:{login:s.login,password:s.password}},o={id:t,payload:n,type:h.USER_LOGOUT};e.sendRequest(o).then(()=>{r.dispatch(Ce(null)),r.dispatch(he(null)),r.unsubscribeAll(l.SET_CURRENT_CHAT),r.unsubscribeAll(l.SET_CURRENT_USER),M(f.LOGIN)}).catch(a=>{N(a),C(a.error)})}}const Qs="_wrapper_1aei6_1",Js="_section_1aei6_10",Se={wrapper:Qs,section:Js};function Zs(){const e=d({className:Se.wrapper}),{isWebsocketOpen:t,currentUser:s}=r.getState();t&&s&&ue(s.login),r.subscribe(l.SET_SOCKET_STATE,({currentUser:u})=>{u&&ue(u.login)});const n=Ks(),o=Ps(),a=Ds(),c=ct({className:Se.section},[o,a]),i=$s();return e.append(n,c,i),e}const js="_form_1am6t_1",en="_fieldset_1am6t_16",fe={form:js,fieldset:en},tn="_container_l4s2c_1",sn="_input_l4s2c_10",nn="_error_l4s2c_22",on="_message_l4s2c_26",an="_visible_l4s2c_32",O={container:tn,input:sn,error:nn,message:on,visible:an};function Te(e){const t=d({className:O.container}),{type:s,name:n,placeholder:o,validator:a}=e,c=Ne({type:s,name:n,placeholder:o,id:n,required:!0,className:O.input}),i=nt({htmlFor:n,className:O.message});return c.addEventListener("input",()=>{rn(c,i,a)}),t.append(c,i),{container:t,input:c}}function cn(e,t,s){t.textContent=s??S,s?(e.classList.add(O.error),t.classList.add(O.visible)):(e.classList.remove(O.error),t.classList.remove(O.visible))}function rn(e,t,s){const n=s(e.value);cn(e,t,n)}function Oe(e){return e.length<$.MIN?G.MIN_LOGIN:e.length>$.MAX?G.MAX_LOGIN:/[^\dA-Za-z]/.test(e)?G.NO_SPECIAL_CHARACTERS:null}function Me(e){let t=null;if(e.length<ge.MIN&&(t=G.MIN_PASSWORD),!/[A-Z]/.test(e)){const s=G.USE_CAPITAL_LETTER;t=t?t+s:s}return t}const ln={type:j.TEXT,name:me.LOGIN,placeholder:v.LOGIN,validator:Oe},dn={type:j.PASSWORD,name:me.PASSWORD,placeholder:v.PASSWORD,validator:Me};function un(){const e=Ae({className:fe.form}),t=Je({className:fe.fieldset}),s=ot({textContent:we});t.append(s);const{container:n,input:o}=Te(ln),{container:a,input:c}=Te(dn),i=g({textContent:"Start",type:Z.SUBMIT,disabled:!0,onClick:_=>{_==null||_.preventDefault(),Ue(o.value,c.value).then(()=>{M(f.CHAT)}).catch(b=>{N(b),C(b.error)})}}),u=()=>{const _=Oe(o.value),b=Me(c.value),W=!_&&!b;i.disabled=!W};return o.addEventListener("input",u),c.addEventListener("input",u),t.append(n,a),e.append(t,i),e}const En="_wrapper_1qcn7_1",pn={wrapper:En};function _n(){const e=d({className:pn.wrapper}),t=un(),s=g({textContent:k.ABOUT,onClick:()=>{M(f.ABOUT)}});return e.append(t,s),e}function Sn(){const e=d({});document.body.append(e),dt(r),R().open(),Bs({root:e,routes:new Map([[f.LOGIN,()=>_n()],[f.CHAT,()=>Zs()],[f.ABOUT,()=>Mt()]])}),window.addEventListener("beforeunload",()=>{ft(r.getState())})}Sn();
